{
  "class": "AS3",
  "action": "deploy",
  "persist": true,
  "declaration": {
    "class": "ADC",
    "schemaVersion": "3.12.0",
    "label": "autoscale_ltm_withExplicitProxy",
    "id": "autoscale_ltm",
    "remark": "autoscale_ltm",
    "Common": {
      "class": "Tenant",
      "Shared": {
        "class": "Application",
        "template": "shared",
        "serviceAddress": {
          "class": "Service_Address",
          "virtualAddress": "0.0.0.0"
        },
        "telemetry_local_rule": {
          "remark": "Only required when TS is a local listener",
          "class": "iRule",
          "iRule": "when CLIENT_ACCEPTED {\n  node 127.0.0.1 6514\n}"
        },
        "telemetry_local": {
          "remark": "Only required when TS is a local listener",
          "class": "Service_TCP",
          "virtualAddresses": [
            "255.255.255.254"
          ],
          "virtualPort": 6514,
          "iRules": [
            "telemetry_local_rule"
          ]
        },
        "telemetry_pool": {
          "class": "Pool",
          "members": [
            {
              "enable": true,
              "serverAddresses": [
                "255.255.255.254"
              ],
              "servicePort": 6514
            }
          ],
          "monitors": [
            {
              "bigip": "/Common/tcp"
            }
          ]
        },
        "telemetry_pool2": {
          "class": "Pool",
          "members": [
            {
              "enable": true,
              "serverAddresses": [
                "255.255.255.254"
              ],
              "servicePort": 6514
            }
          ],
          "monitors": [
            {
              "bigip": "/Common/tcp"
            }
          ]
        },
        "telemetry_hsl": {
          "class": "Log_Destination",
          "type": "remote-high-speed-log",
          "protocol": "tcp",
          "pool": {
            "use": "telemetry_pool"
          }
        },
        "telemetry_publisher": {
          "class": "Log_Publisher",
          "destinations": [
          {
            "use": "telemetry_hsl"
          }
          ]
        }
      }
    },
    "ExplicitProxy" : {
      "class": "Tenant",
      "explicitProxy": {
        "class": "Application",
        "template": "generic",
        "srcipToDatagroup": {
          "class": "Data_Group",
          "keyDataType": "ip",
          "records": [
            {
              "key": "10.10.10.0/24",
              "value": "clientA_hosts_datagroup"
            },
            {
              "key": "20.10.10.0/24",
              "value": "clientB_hosts_datagroup"
            },
            {
              "key": "30.10.10.0/24",
              "value": "clientC_hosts_datagroup"
            }
          ]
        },
        "all_uris": {
          "class": "Data_Group",
          "keyDataType": "string",
          "records": [
            {"key": "/"}
          ]
        },
        "clientA_hosts_datagroup": {
          "class": "Data_Group",
          "keyDataType": "string",
          "records": [
            {
              "key": "www.google.com",
              "value": "clientA_google_allow_uri_list_1"
            },
            {
              "key": "f5.com",
              "value": "all_uris"
            },
            { 
              "key": "chase.com",
              "value": "all_uris"             
            }
          ]
        },
        "clientB_hosts_datagroup": {
          "class": "Data_Group",
          "keyDataType": "string",
          "records": [
            {
              "key": "www.starbucks.com",
              "value": "all_uris"
            },
            {
              "key": "www.target.com",
              "value": "all_uris"
            },
            { 
              "key": "www.spacex.com",
              "value": "all_uris"             
            }
          ]
        },
        "clientA_google_allow_uri_list_1": {
          "class": "Data_Group",
          "keyDataType": "string",
          "records": [
            {"key": "/maps"},
            {"key": "/search"},
            {"key": "/device"}
          ]
        },
        "explicitProxy_irule": {
          "class": "iRule",
          "iRule": {
            "base64": ""
          }
        },
        "explicitHttps_irule": {
          "class": "iRule",
          "iRule": {
            "base64": ""
          }
        },
        "explicitProxyhttp_profile": {
          "class": "HTTP_Profile",
          "proxyType": "explicit",
          "requestChunking": "rechunk",
          "responseChunking": "rechunk",
          "resolver": {"bigip": "/Common/explicitProxy_resolver"},
          "tunnelName": "/Common/explicitProxy_tunnel"
        },
        "explicitProxyVS": {
          "class": "Service_HTTP",
          "layer4": "tcp",
          "profileTCP": "tcpOpt23",
          "virtualAddresses": [
            {
              "use": "/Common/Shared/serviceAddress"
            }
          ],
          "persistenceMethods": [],
          "virtualPort": 10443,
          "profileHTTP": {"use": "explicitProxyhttp_profile"},
          "snat": "auto",
          "allowVlans": [{"bigip":"/Common/internal"}],
          "iRules": ["explicitProxy_irule"]
        },
        "explicitProxy_HTTPS_VS": {
          "class": "Service_HTTPS",
          "layer4": "tcp",
          "profileTCP": "tcpOpt23",
          "redirect80": false,
          "virtualAddresses": [
            {
              "use": "/Common/Shared/serviceAddress"
            }
          ],
          "persistenceMethods": [],
          "translateServerPort": false,
          "translateServerAddress": false,
          "virtualPort": 443,
          "profileHTTP": {"bigip": "/Common/http"},
          "snat": "auto",
          "allowVlans": [{"bigip":"/Common/explicitProxy_tunnel"}],
          "clientTLS": {"bigip": "/Common/clientTLS_SSL_FORWARD_PROXY"},
          "serverTLS": {"bigip": "/Common/serverTLS_SSL_FORWARD_PROXY"},
          "iRules": ["explicitHttps_irule"]
        }
      }
    }
  }
}
